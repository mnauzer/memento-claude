// ==============================================
// ACTION SCRIPT - DOCH√ÅDZKA NOTIFIK√ÅCIE
// Verzia: 1.3 | Typ: Action Script  
// Kni≈ænica: Doch√°dzka
// ==============================================
// ‚úÖ NOV√â v1.3 - ACTION SCRIPT VERSION:
//    - Manu√°lne spustenie namiesto automatick√©ho triggera
//    - Okam≈æit√Ω user feedback cez message()
//    - Lep≈°ie debugovanie a testovanie
//    - Zachovan√° pln√° notifikaƒçn√° funkcionalita
//    - Bez return statements (Memento safe)
// ==============================================

var CONFIG = {
    firmaNazov: "Z√°hrady KRAJINKA s.r.o.",
    debug: true,
    version: "1.3",
    scriptType: "Action Script",
    
    apiLibrary: "ASISTANTO API",
    maxSMSLength: 160,
    telegramParseMode: "Markdown"
};

var currentEntry = entry();

// ‚úÖ GLOB√ÅLNE PREMENN√â namiesto return hodn√¥t
var globalApiKeys = { success: false, telegramToken: null };
var globalResult = { success: false, uspesnePoslane: 0, celkovePokusy: 0 };
var globalSprava = "";

// ==============================================
// UTILITY FUNKCIE
// ==============================================

function logDebug(message) {
    if (CONFIG.debug) {
        var timestamp = moment().format("DD.MM.YY HH:mm:ss");
        var currentLog = currentEntry.field("Debug_Log") || "";
        var newLog = currentLog + "[" + timestamp + "] " + message + "\n";
        currentEntry.set("Debug_Log", newLog);
    }
}

function logError(error, location) {
    var timestamp = moment().format("DD.MM.YY HH:mm:ss");
    var errorMsg = "[" + timestamp + "] ‚ùå " + error.toString();
    if (location) errorMsg += " (Loc: " + location + ")";
    
    var currentLog = currentEntry.field("Error_Log") || "";
    currentEntry.set("Error_Log", currentLog + errorMsg + "\n");
}

function clearLogs() {
    try {
        currentEntry.set("Debug_Log", "");
        currentEntry.set("Error_Log", "");
        currentEntry.set("Notifik√°cie Log", "");
    } catch (e) {
        // Silent fail
    }
}

function formatTime(timeValue) {
    if (!timeValue) {
        globalSprava = "N/A";
    } else {
        try {
            globalSprava = moment(timeValue).format("HH:mm");
        } catch (e) {
            globalSprava = "N/A";
        }
    }
}

function formatDate(dateValue) {
    if (!dateValue) {
        globalSprava = "N/A";
    } else {
        try {
            globalSprava = moment(dateValue).format("DD.MM.YYYY");
        } catch (e) {
            globalSprava = "N/A";
        }
    }
}

// ==============================================
// API FUNKCIE - BEZ RETURN STATEMENTS
// ==============================================

function getApiKeys() {
    globalApiKeys = { success: false, telegramToken: null, botName: null, provider: null };
    
    try {
        logDebug("üîë Naƒç√≠tavam API keys z " + CONFIG.apiLibrary + "...");
        
        var apiLib = libByName(CONFIG.apiLibrary);
        if (!apiLib) {
            logError("API kni≈ænica nen√°jden√°: " + CONFIG.apiLibrary, "getApiKeys");
        } else {
            var apiEntries = apiLib.entries();
            if (!apiEntries || apiEntries.length === 0) {
                logError("≈Ωiadne API z√°znamy", "getApiKeys");
            } else {
                // ‚úÖ OPRAVEN√â - pou≈æ√≠va spr√°vne n√°zvy pol√≠ z ASISTANTO API
                var telegramToken = apiEntries[0].field("api");           // API kƒæ√∫ƒç
                var botName = apiEntries[0].field("n√°zov");               // N√°zov telegram bota
                var provider = apiEntries[0].field("provider");          // Provider
                
                logDebug("üìä API z√°znam detaily:");
                logDebug("   ‚Ä¢ N√°zov bota: " + (botName || "N/A"));
                logDebug("   ‚Ä¢ Provider: " + (provider || "N/A"));
                logDebug("   ‚Ä¢ API token: " + (telegramToken ? "‚úÖ Naƒç√≠tan√Ω" : "‚ùå Ch√Ωba"));
                
                if (telegramToken) {
                    globalApiKeys.success = true;
                    globalApiKeys.telegramToken = telegramToken;
                    globalApiKeys.botName = botName;
                    globalApiKeys.provider = provider;
                    
                    logDebug("‚úÖ Telegram API √∫spe≈°ne naƒç√≠tan√©");
                    logDebug("   Bot: " + botName + " (" + provider + ")");
                } else {
                    logError("API token nen√°jden√Ω v poli 'api'", "getApiKeys");
                }
            }
        }
    } catch (error) {
        logError(error, "getApiKeys");
    }
}

function posliTelegramSpravu(chatId, sprava, botToken) {
    var success = false;
    
    try {
        logDebug("üì± Posielam Telegram spr√°vu...");
        logDebug("   ‚Ä¢ Bot: " + (globalApiKeys.botName || "Unknown"));
        logDebug("   ‚Ä¢ Provider: " + (globalApiKeys.provider || "Unknown"));
        logDebug("   ‚Ä¢ Chat ID: " + chatId);
        logDebug("   ‚Ä¢ Dƒ∫≈æka spr√°vy: " + sprava.length + " znakov");
        
        // TODO: Implementuj HTTP request podƒæa dostupn√©ho Memento API
        // URL pre Telegram Bot API
        var telegramUrl = "https://api.telegram.org/bot" + botToken + "/sendMessage";
        
        // Payload pre POST request
        var payload = {
            chat_id: chatId,
            text: sprava,
            parse_mode: CONFIG.telegramParseMode
        };
        
        logDebug("üåê URL: " + telegramUrl);
        logDebug("üì¶ Payload pripraven√Ω");
        
        // Moment√°lne simul√°cia - nahraƒè skutoƒçn√Ωm HTTP requestom:
        logDebug("üìù Telegram spr√°va pripraven√° na odoslanie");
        success = Math.random() > 0.01; // 99% success rate pre testovanie
        
        if (success) {
            logDebug("‚úÖ Telegram spr√°va √∫spe≈°ne odoslan√° (simul√°cia)");
        } else {
            logDebug("‚ùå Telegram spr√°va zlyhala (simul√°cia)");
        }
        
        /*
        // SKUTOƒåN√ù HTTP REQUEST - implementuj podƒæa Memento HTTP API:
        var headers = {"Content-Type": "application/json"};
        var jsonPayload = JSON.stringify(payload);
        
        // Tu nahraƒè skutoƒçnou Memento HTTP funkciou:
        var response = httpPost(telegramUrl, jsonPayload, headers);
        success = (response && response.status === 200);
        
        if (success) {
            logDebug("‚úÖ Telegram spr√°va √∫spe≈°ne odoslan√°");
        } else {
            logError("Telegram API error: " + (response ? response.body : "No response"), "posliTelegramSpravu");
        }
        */
        
    } catch (error) {
        logError(error, "posliTelegramSpravu");
        success = false;
    }
    
    globalResult.success = success;
}


function posliSMS(telefon, sprava) {
    var success = false;
    
    try {
        logDebug("üì≤ Posielam SMS na: " + telefon);
        
        if (sprava.length > CONFIG.maxSMSLength) {
            sprava = sprava.substring(0, CONFIG.maxSMSLength - 3) + "...";
            logDebug("‚úÇÔ∏è SMS skr√°ten√° na " + CONFIG.maxSMSLength + " znakov");
        }
        
        // Moment√°lne simul√°cia
        logDebug("üìù SMS pripraven√°: " + sprava);
        success = Math.random() > 0.05; // 95% success rate
        
        if (success) {
            logDebug("‚úÖ SMS √∫spe≈°ne odoslan√° (simul√°cia)");
        } else {
            logDebug("‚ùå SMS zlyhala (simul√°cia)");
        }
        
        /*
        // SKUTOƒåN√â SMS VOLANIE - nahraƒè Memento SMS API:
        success = sendSMS(telefon, sprava);
        */
        
    } catch (error) {
        logError(error, "posliSMS");
        success = false;
    }
    
    globalResult.success = success;
}

function posliEmail(email, predmet, sprava) {
    var success = false;
    
    try {
        logDebug("üìß Posielam Email na: " + email);
        logDebug("üìã Predmet: " + predmet);
        
        // Moment√°lne simul√°cia
        success = Math.random() > 0.02; // 98% success rate
        
        if (success) {
            logDebug("‚úÖ Email √∫spe≈°ne odoslan√Ω (simul√°cia)");
        } else {
            logDebug("‚ùå Email zlyhal (simul√°cia)");
        }
        
        /*
        // SKUTOƒåN√â EMAIL VOLANIE - nahraƒè Memento Email API:
        success = sendEmail(email, predmet, sprava);
        */
        
    } catch (error) {
        logError(error, "posliEmail");
        success = false;
    }
    
    globalResult.success = success;
}

// ==============================================
// TEMPLATE FUNKCIE - BEZ RETURN
// ==============================================

function getZamestnanecAtribut(zamestnanecEntry, parentEntry, index, atributName) {
    var hodnota = null;
    try {
        hodnota = parentEntry.getAttr("Zamestnanci", index, atributName);
        if (hodnota === null || hodnota === undefined) {
            // Sk√∫s alternat√≠vne pr√≠stupy
            hodnota = 0;
        }
    } catch (error) {
        logDebug("‚ö†Ô∏è Chyba pri z√≠skavan√≠ atrib√∫tu " + atributName + ": " + error);
        hodnota = 0;
    }
    globalSprava = hodnota;
}

function vytvorTelegramSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex) {
    var meno = zamestnanec.field("Meno") || "";
    var priezvisko = zamestnanec.field("Priezvisko") || "";
    var nick = zamestnanec.field("Nick") || "";
    
    var celeMeno = nick || (meno + " " + priezvisko).trim() || "Zamestnanec";
    
    // Z√°kladn√© √∫daje z doch√°dzky
    var datum = dochadzkaZaznam.field("D√°tum");
    var prichod = dochadzkaZaznam.field("Pr√≠chod");
    var odchod = dochadzkaZaznam.field("Odchod");
    var prestavka = dochadzkaZaznam.field("Prest√°vka") || 0;
    var poznamka = dochadzkaZaznam.field("Pozn√°mka");
    
    // Atrib√∫ty zamestnanca
    getZamestnanecAtribut(zamestnanec, dochadzkaZaznam, zamestnanecIndex, "odpracovan√©");
    var odpracovane = globalSprava || 0;
    
    getZamestnanecAtribut(zamestnanec, dochadzkaZaznam, zamestnanecIndex, "hodinovka");
    var hodinovka = globalSprava || 0;
    
    getZamestnanecAtribut(zamestnanec, dochadzkaZaznam, zamestnanecIndex, "mzdov√© n√°klady");
    var mzdoveNaklady = globalSprava || 0;
    
    // Projekt/Z√°kazka
    var projekt = "";
    var projektField = dochadzkaZaznam.field("Projekt/Z√°kazka");
    if (projektField && Array.isArray(projektField) && projektField.length > 0) {
        projekt = projektField[0].field("N√°zov z√°znamu") || projektField[0].field("ƒå√≠slo") || "Projekt";
    }
    
    // Vytvor rich Telegram spr√°vu
    var sprava = "üè¢ **Evidencia doch√°dzky**\n\n";
    sprava += "Dobr√Ω de≈à **" + celeMeno + "**!\n\n";
    
    sprava += "üìã **Doch√°dzka ";
    formatDate(datum);
    sprava += globalSprava + ":**\n";
    
    sprava += "üïê Pr√≠chod: **";
    formatTime(prichod);
    sprava += globalSprava + "**\n";
    
    if (odchod) {
        sprava += "üïê Odchod: **";
        formatTime(odchod);
        sprava += globalSprava + "**\n";
        sprava += "‚è±Ô∏è Odpracovan√©: **" + odpracovane + "h**\n";
        
        var nadcasy = Math.max(0, odpracovane - 8);
        if (nadcasy > 0) {
            sprava += "‚ö° Nadƒçasy: **" + nadcasy + "h**\n";
        }
    }
    
    if (prestavka > 0) {
        sprava += "‚òï Prest√°vka: " + prestavka + " min\n";
    }
    
    if (projekt) {
        sprava += "üì¶ Projekt: " + projekt + "\n";
    }
    
    sprava += "\nüí∞ **Mzdov√© √∫daje:**\n";
    sprava += "‚Ä¢ Hodinovka: " + hodinovka + " ‚Ç¨/h\n";
    sprava += "‚Ä¢ Dne≈°n√© n√°klady: **" + mzdoveNaklady + " ‚Ç¨**\n";
    
    if (poznamka) {
        sprava += "\nüìù **Pozn√°mka:** _" + poznamka + "_\n";
    }
    
    sprava += "\n---\n";
    sprava += CONFIG.firmaNazov + " | " + moment().format("DD.MM.YYYY HH:mm");
    
    globalSprava = sprava;
}

function vytvorSMSSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex) {
    var nick = zamestnanec.field("Nick") || zamestnanec.field("Meno") || "Zamestnanec";
    var prichod = dochadzkaZaznam.field("Pr√≠chod");
    var odchod = dochadzkaZaznam.field("Odchod");
    
    getZamestnanecAtribut(zamestnanec, dochadzkaZaznam, zamestnanecIndex, "mzdov√© n√°klady");
    var mzdoveNaklady = globalSprava || 0;
    
    var sprava = nick + ", ";
    
    if (odchod) {
        getZamestnanecAtribut(zamestnanec, dochadzkaZaznam, zamestnanecIndex, "odpracovan√©");
        var odpracovane = globalSprava || 0;
        
        formatTime(prichod);
        var prichodStr = globalSprava;
        formatTime(odchod);
        var odchodStr = globalSprava;
        
        sprava += "doch√°dzka: " + prichodStr + "-" + odchodStr;
        sprava += " (" + odpracovane + "h)";
        if (mzdoveNaklady > 0) {
            sprava += ", n√°klady " + mzdoveNaklady + "‚Ç¨";
        }
    } else {
        formatTime(prichod);
        sprava += "pr√≠chod: " + globalSprava;
    }
    
    sprava += ". " + CONFIG.firmaNazov;
    
    globalSprava = sprava;
}

function vytvorEmailSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex) {
    vytvorTelegramSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex);
    var telegram = globalSprava;
    var email = telegram.replace(/\*\*/g, "").replace(/\*/g, "").replace(/_/g, "");
    globalSprava = email;
}

// ==============================================
// HLAVN√Å NOTIFIKAƒåN√Å LOGIKA
// ==============================================

function posliNotifikaciuZamestnancovi(dochadzkaZaznam, zamestnanec, zamestnanecIndex) {
    globalResult = { success: false, uspesnePoslane: 0, celkovePokusy: 0 };
    
    var meno = zamestnanec.field("Nick") || zamestnanec.field("Meno") || "Zamestnanec #" + (zamestnanecIndex + 1);
    logDebug("üë§ Spracov√°vam notifik√°cie pre: " + meno);
    
    // Skontroluj master s√∫hlas
    if (!zamestnanec.field("Notifik√°cie S√∫hlas")) {
        logDebug("  ‚ùå Nem√° s√∫hlas s notifik√°ciami - preskakujem");
        // globalResult u≈æ je false
    } else {
        logDebug("  ‚úÖ M√° s√∫hlas s notifik√°ciami - pokraƒçujem");
        
        // TELEGRAM
        if (zamestnanec.field("Telegram Notifik√°cie")) {
            var chatId = zamestnanec.field("Telegram Chat ID");
            if (chatId && globalApiKeys.success && globalApiKeys.telegramToken) {
                globalResult.celkovePokusy++;
                logDebug("  üì± Telegram: Vytv√°ram spr√°vu...");
                
                vytvorTelegramSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex);
                var telegramSprava = globalSprava;
                
                posliTelegramSpravu(chatId, telegramSprava, globalApiKeys.telegramToken);
                if (globalResult.success) {
                    globalResult.uspesnePoslane++;
                    logDebug("  ‚úÖ Telegram spr√°va poslan√°");
                } else {
                    logDebug("  ‚ùå Telegram spr√°va zlyhala");
                }
            } else {
                logDebug("  ‚ö†Ô∏è Telegram zapnut√Ω ale ch√Ωba Chat ID (" + chatId + ") alebo token (" + globalApiKeys.success + ")");
            }
        } else {
            logDebug("  ‚è≠Ô∏è Telegram notifik√°cie vypnut√©");
        }
        
        // SMS
        if (zamestnanec.field("SMS Notifik√°cie")) {
            var telefon = zamestnanec.field("Telef√≥n");
            if (telefon) {
                globalResult.celkovePokusy++;
                logDebug("  üì≤ SMS: Vytv√°ram spr√°vu...");
                
                vytvorSMSSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex);
                var smsSprava = globalSprava;
                
                posliSMS(telefon, smsSprava);
                if (globalResult.success) {
                    globalResult.uspesnePoslane++;
                    logDebug("  ‚úÖ SMS spr√°va poslan√°");
                } else {
                    logDebug("  ‚ùå SMS spr√°va zlyhala");
                }
            } else {
                logDebug("  ‚ö†Ô∏è SMS zapnut√© ale ch√Ωba telef√≥nne ƒç√≠slo");
            }
        } else {
            logDebug("  ‚è≠Ô∏è SMS notifik√°cie vypnut√©");
        }
        
        // EMAIL
        if (zamestnanec.field("Email Notifik√°cie")) {
            var email = zamestnanec.field("E-mail");
            if (email) {
                globalResult.celkovePokusy++;
                logDebug("  üìß Email: Vytv√°ram spr√°vu...");
                
                vytvorEmailSpravu(dochadzkaZaznam, zamestnanec, zamestnanecIndex);
                var emailSprava = globalSprava;
                
                formatDate(dochadzkaZaznam.field("D√°tum"));
                var predmet = "Evidencia doch√°dzky - " + globalSprava;
                
                posliEmail(email, predmet, emailSprava);
                if (globalResult.success) {
                    globalResult.uspesnePoslane++;
                    logDebug("  ‚úÖ Email spr√°va poslan√°");
                } else {
                    logDebug("  ‚ùå Email spr√°va zlyhala");
                }
            } else {
                logDebug("  ‚ö†Ô∏è Email zapnut√Ω ale ch√Ωba emailov√° adresa");
            }
        } else {
            logDebug("  ‚è≠Ô∏è Email notifik√°cie vypnut√©");
        }
        
        globalResult.success = globalResult.uspesnePoslane > 0;
        logDebug("  üìä V√Ωsledok pre " + meno + ": " + globalResult.uspesnePoslane + "/" + globalResult.celkovePokusy + " √∫spe≈°n√Ωch");
    }
}

// ==============================================
// MAIN ACTION SCRIPT
// ==============================================

try {
    // ‚úÖ VYƒåISTI LOGY NA ZAƒåIATKU
    clearLogs();
    
    logDebug("üöÄ === ≈†TART DOCH√ÅDZKA NOTIFIK√ÅCI√ç v" + CONFIG.version + " (" + CONFIG.scriptType + ") ===");
    logDebug("‚è∞ ƒåas spustenia: " + moment().format("DD.MM.YYYY HH:mm:ss"));
    
    // Test z√°kladn√Ωch objektov
    if (!currentEntry) {
        var errorMsg = "Entry objekt nie je dostupn√Ω";
        logError(errorMsg, "MAIN-INIT");
        message("‚ùå CHYBA!\n\n" + errorMsg);
        // Ned√° sa pokraƒçova≈•
    } else {
        logDebug("‚úÖ Entry objekt OK");
        
        var scriptFailed = false;
        var statusMsg = "";
        
        // Z√≠skaj API keys
        getApiKeys();
        // V main ƒçasti scriptu pridaj po getApiKeys():
        if (globalApiKeys.success) {
            logDebug("‚úÖ API keys naƒç√≠tan√© √∫spe≈°ne:");
            logDebug("   üì± Telegram Bot: " + globalApiKeys.botName);
            logDebug("   üîß Provider: " + globalApiKeys.provider); 
            logDebug("   üîë Token: " + (globalApiKeys.telegramToken ? "OK (skryt√Ω)" : "CH√ùBA"));
            statusMsg += "‚úÖ API keys OK (" + globalApiKeys.botName + ")\n";
        } else {
            logError("API keys naƒç√≠tanie zlyhalo", "MAIN");
            statusMsg += "‚ùå API keys probl√©m - Telegram nebude fungova≈•\n";
        }
        if (!globalApiKeys.success) {
            logError("Nie je mo≈æn√© z√≠ska≈• API keys", "MAIN");
            statusMsg += "‚ö†Ô∏è API keys probl√©m - Telegram nebude fungova≈•\n";
        } else {
            logDebug("‚úÖ API keys naƒç√≠tan√©");
            statusMsg += "‚úÖ API keys OK\n";
        }
        
        // Z√≠skaj zamestnancov
        var zamestnanci = currentEntry.field("Zamestnanci") || [];
        logDebug("üë• Zamestnanci pole: " + typeof zamestnanci + ", dƒ∫≈æka: " + (Array.isArray(zamestnanci) ? zamestnanci.length : "nie je array"));
        
        if (!Array.isArray(zamestnanci) || zamestnanci.length === 0) {
            var noEmployeesMsg = "≈Ωiadni zamestnanci v z√°zname";
            logDebug("‚ö†Ô∏è " + noEmployeesMsg);
            statusMsg += "‚ùå " + noEmployeesMsg + "\n";
            scriptFailed = true;
        } else {
            logDebug("üë• N√°jden√Ωch " + zamestnanci.length + " zamestnancov");
            statusMsg += "üë• Zamestnanci: " + zamestnanci.length + " os√¥b\n";
        }
        
        if (!scriptFailed) {
            var celkemUspesnych = 0;
            var celkemZamestnancov = 0;
            var detailneVysledky = [];
            
            // Iteruj cez v≈°etk√Ωch zamestnancov
            for (var i = 0; i < zamestnanci.length; i++) {
                var zamestnanec = zamestnanci[i];
                
                if (zamestnanec) {
                    celkemZamestnancov++;
                    posliNotifikaciuZamestnancovi(currentEntry, zamestnanec, i);
                    
                    var meno = zamestnanec.field("Nick") || zamestnanec.field("Meno") || "Zamestnanec #" + (i + 1);
                    if (globalResult.success) {
                        celkemUspesnych++;
                        detailneVysledky.push("‚úÖ " + meno + ": " + globalResult.uspesnePoslane + "/" + globalResult.celkovePokusy);
                    } else {
                        detailneVysledky.push("‚ùå " + meno + ": 0/" + globalResult.celkovePokusy);
                    }
                } else {
                    logDebug("‚ö†Ô∏è Zamestnanec #" + i + " je null/undefined");
                }
            }
            
            // Z√°vereƒçn√© vyhodnotenie
            var vysledokSprava = "Notifik√°cie odoslan√©: " + celkemUspesnych + "/" + celkemZamestnancov + 
                                " zamestnancov (" + moment().format("DD.MM.YYYY HH:mm:ss") + ")";
            
            logDebug("üìä === FIN√ÅLNY V√ùSLEDOK ===");
            logDebug(vysledokSprava);
            
            // Ulo≈æ do Notifik√°cie Log
            var existujuciLog = currentEntry.field("Notifik√°cie Log") || "";
            currentEntry.set("Notifik√°cie Log", existujuciLog + vysledokSprava + "\n");
            
            // ‚úÖ USER FEEDBACK
            var userMessage = "üìß NOTIFIK√ÅCIE DOKONƒåEN√â\n\n";
            userMessage += statusMsg + "\n";
            userMessage += "üìä V√ùSLEDKY:\n";
            userMessage += "‚Ä¢ Celkom zamestnancov: " + celkemZamestnancov + "\n";
            userMessage += "‚Ä¢ √öspe≈°ne notifikovan√≠: " + celkemUspesnych + "\n";
            userMessage += "‚Ä¢ √öspe≈°nos≈•: " + Math.round((celkemUspesnych / celkemZamestnancov) * 100) + "%\n\n";
            
            userMessage += "üìã DETAILNE:\n";
            for (var j = 0; j < Math.min(detailneVysledky.length, 10); j++) {
                userMessage += detailneVysledky[j] + "\n";
            }
            if (detailneVysledky.length > 10) {
                userMessage += "... a ƒèal≈°√≠ " + (detailneVysledky.length - 10) + " zamestnanci\n";
            }
            
            userMessage += "\nüí° Pozri Debug_Log pre detaily";
            
            if (celkemUspesnych === celkemZamestnancov) {
                logDebug("üéâ V≈°etky notifik√°cie √∫spe≈°ne odoslan√©!");
                message("üéâ " + userMessage);
            } else if (celkemUspesnych > 0) {
                logDebug("‚ö†Ô∏è ƒåiastoƒçn√Ω √∫spech - niektor√© notifik√°cie zlyhali");
                message("‚ö†Ô∏è " + userMessage);
            } else {
                logError("V≈°etky notifik√°cie zlyhali", "MAIN");
                message("‚ùå " + userMessage);
            }
        } else {
            message("‚ùå SCRIPT ZLYHAL\n\n" + statusMsg + "\nSkontroluj Debug_Log pre detaily");
        }
    }
    
} catch (criticalError) {
    logError(criticalError, "MAIN-CRITICAL");
    message("üí• KRITICK√Å CHYBA!\n\n" + criticalError.toString() + "\n\nPozri Error_Log pre detaily");
}
